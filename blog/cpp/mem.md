# C++ 内存表示

## 起源

最近一直在研究c++, 在使用指针的时候遇到问题，就通过`lldb`调试程序，可是得到的结果自己一直看不懂，一度以为`c++`内存有其他说法, 这里记录一下

## 问题

起初源于这段代码

```c++
float* a = new float[4];

for (int i=0; i<4; i++) {
	a[i] = (float)i;
}
```

当我要去看内存的时候，我一度以为是自己没找对地方

<img src="https://fastly.jsdelivr.net/gh/lblbk/picgo/work/memory01.png" style="zoom:50%;" />

这个我完全没看懂和我存储的值`[0, 1, 2, 3]`有任何关系，这里我又选择了其他两种方案，直接在vs code输入gdb命令查看，以及通过函数打印，结果一样

<img src="https://fastly.jsdelivr.net/gh/lblbk/picgo/work/memory02.png" style="zoom:50%;" />

> 这里大概说一下三种方式
>
> 1. [Hex Editor - Visual Studio Marketplace](https://marketplace.visualstudio.com/items?itemName=ms-vscode.hexeditor) 这个插件可以直接让你看到内存信息
>
> 2. vscode+cmake方式编写的话，debug模式下可以直接调用gdb命令，只需加上`-exec command`
>
> 3. 硬核方式自己写
>
>    ```cc
>    void memory_dump(void *ptr, int len) {
>      int i;
>    
>      for (i = 0; i < len; i++) {
>        if (i % 8 == 0 && i != 0)
>          printf(" ");
>        if (i % 16 == 0 && i != 0)
>          printf("\n");
>        printf("%02x ", *((uint8_t *)ptr + i));
>      }
>      printf("\n");
>    }
>    ```
>
>    上图很形象了，在`watch`加上函数和想查看的变量就好了

## 整型

这时候我就想通过整形数值去测试结果

```c++
int* a = new int[4];

for (int i=0; i<4; i++) {
  a[i] = i;
}
```

这里打印的是

```
00 00 00 00 01 00 00 00  02 00 00 00 03 00 00 00
11 00 00 00 11 00 00 00  11 00 00 00 11 00 00 00 
```

这里看着好像有那么一点靠谱，但是我就是对不上号

```
00 00 00 00 -> 0
01 00 00 00 -> 64
02 00 00 00 -> ?
03 00 00 00 -> ?
```

## 大端 小端

。。。

### 整型解析

所以整形打印的结果应该是

```
00 00 00 00 -> 0
00 00 00 01 -> 1
00 00 00 02 -> 2
00 00 00 03 -> 3
```

这里是用16进制表示

举个🌰

```
0a 00 00 00 0b 00 00 00  0c 00 00 00 0d 00 00 00
0e 00 00 00 0f 00 00 00  10 00 00 00 11 00 00 00 
```

展开一下就是

```
00 00 00 0a -> 10
00 00 00 0b -> 11
00 00 00 0c -> 12
00 00 00 0d -> 13
00 00 00 0e -> 14
00 00 00 0f -> 15
00 00 00 10 -> 16
00 00 00 11 -> 17
```

## 浮点型

整型对上号了，那浮点型还是对不上啊，突然想到组原学到的浮点类型表示方法

```
00 00 00 00 00 00 80 3f  00 00 00 40 00 00 40 40
```

这里的表示应该是

```
00 00 00 00
3f 80 00 00
40 00 00 00
40 40 00 00
```

### 表示方法

[c/c++ 中 double 和 float 在内存中的存储结构 – 梦依稀 (mengyixi.com)](https://mengyixi.com/post/double_float_storage/)

### 浮点型解析

```
3f 80 00 00
0011 1111 1000 0000 0000 0000 0000 0000 // 每个数字写成二进制
```

$S=(-1)^0=1$

$E=(011 1111 1)_2-127_{10}=0_{10}$